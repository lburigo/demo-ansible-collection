[tox]
env_list =
    venv
    py3{9,10,11,12,13}-2.{14,15,16,17,18}
no_package = true
skipsdist = true
ignore_errors = true
skip_missing_interpreters = true

[ansible]
skip =
    py3.7
    py3.8
    2.9
    2.10
    2.11
    2.12
    2.13
    devel
    milestone

[testenv:venv]
set_env =
    FORCE_COLOR = 1
download = True
passenv =
    ANSIBLE_GALAXY_*
deps =
    -r test-requirements.txt
allowlist_externals =
    mkdir
    ln
    bash
commands =
    mkdir -p "{env:HOME}/.ansible/collections/ansible_collections"
    ansible-galaxy collection install "{toxinidir}" -p '{env:HOME}/.ansible/collections/ansible_collections' --force
    ansible-galaxy collection install -r "{toxinidir}/requirements-dev.yml"

[testenv]
set_env =
    COLLECTIONS_PATH = "{env:HOME}/.ansible/collections/ansible_collections"
    FORCE_COLOR = 1
passenv =
    HOME
    ANSIBLE_COLLECTIONS_PATH
no_package = true
deps =
    -r tests/integration/requirements.txt
change_dir = {env:HOME}/.ansible/collections/ansible_collections/example/demo
skip_install = false
allowlist_externals =
    bash
commands =
    bash -c 'git init --initial-branch=main .'
    bash -c 'ansible-test integration'
